<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My MP4 Music Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #121212;
    color: white;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
}
header {
    background-color: #1db954;
    padding: 15px;
    font-size: 20px;
    font-weight: bold;
}
#playlist {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
}
.track {
    padding: 8px;
    cursor: pointer;
    border-bottom: 1px solid #333;
}
.track:hover {
    background-color: #282828;
}
#player-controls {
    background-color: #181818;
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
audio {
    width: 100%;
}
button {
    background: none;
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
}
input[type=range] {
    cursor: pointer;
}
</style>
</head>
<body>
<header>My MP4 Music Player</header>
<div id="playlist"></div>
<div id="player-controls">
    <button id="prevBtn">⏮</button>
    <button id="playPauseBtn">▶</button>
    <button id="nextBtn">⏭</button>
    <input type="range" id="seekBar" value="0" step="0.01">
    <input type="range" id="volumeBar" min="0" max="1" step="0.01" value="1">
</div>
<audio id="audioPlayer" controls style="display:none;"></audio>

<script>
const API_KEY = "AIzaSyB0nTrRieFp3iKYKo15B2gqJEE3SlFAo0A";
const FOLDER_ID = "1TQcruPfeldisldQxIjNTXd6WSmX8jn8i";
let tracks = [];
let currentIndex = 0;

// Fetch all files in the folder (video/audio)
async function fetchFiles(pageToken = "") {
    let url = `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+(mimeType contains 'video' or mimeType contains 'audio')&fields=files(id,name),nextPageToken&pageSize=100&key=${API_KEY}`;
    if (pageToken) url += `&pageToken=${pageToken}`;
    let res = await fetch(url);
    let data = await res.json();
    if (data.files) {
        tracks = tracks.concat(data.files);
    }
    if (data.nextPageToken) {
        await fetchFiles(data.nextPageToken);
    }
}

function renderPlaylist() {
    const playlist = document.getElementById("playlist");
    playlist.innerHTML = "";
    if (tracks.length === 0) {
        playlist.innerHTML = "<p>No public video/audio files found in folder.</p>";
        return;
    }
    tracks.forEach((track, index) => {
        let div = document.createElement("div");
        div.className = "track";
        div.textContent = track.name;
        div.onclick = () => playTrack(index);
        playlist.appendChild(div);
    });
}

function playTrack(index) {
    currentIndex = index;
    const audioPlayer = document.getElementById("audioPlayer");
    const fileId = tracks[index].id;
    const src = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${API_KEY}`;
    audioPlayer.src = src;
    audioPlayer.play();
    document.getElementById("playPauseBtn").textContent = "⏸";
}

document.getElementById("playPauseBtn").onclick = () => {
    const audioPlayer = document.getElementById("audioPlayer");
    if (audioPlayer.paused) {
        audioPlayer.play();
        document.getElementById("playPauseBtn").textContent = "⏸";
    } else {
        audioPlayer.pause();
        document.getElementById("playPauseBtn").textContent = "▶";
    }
};

document.getElementById("nextBtn").onclick = () => {
    currentIndex = (currentIndex + 1) % tracks.length;
    playTrack(currentIndex);
};

document.getElementById("prevBtn").onclick = () => {
    currentIndex = (currentIndex - 1 + tracks.length) % tracks.length;
    playTrack(currentIndex);
};

document.getElementById("seekBar").oninput = (e) => {
    const audioPlayer = document.getElementById("audioPlayer");
    if (audioPlayer.duration) {
        audioPlayer.currentTime = e.target.value * audioPlayer.duration;
    }
};

document.getElementById("volumeBar").oninput = (e) => {
    document.getElementById("audioPlayer").volume = e.target.value;
};

document.getElementById("audioPlayer").ontimeupdate = () => {
    const audioPlayer = document.getElementById("audioPlayer");
    if (audioPlayer.duration) {
        document.getElementById("seekBar").value = audioPlayer.currentTime / audioPlayer.duration;
    }
};

// Init
(async () => {
    await fetchFiles();
    renderPlaylist();
})();
</script>
</body>
</html>
